<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Web Scraping</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-171418385-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
    dataLayer.push(arguments);
  }
  gtag('js', new Date());

  gtag('config', 'UA-171418385-1');
</script>

<!-- script hiding navbar when scrolling down -->

<script>
  var didScroll;
  var lastScrollTop = 0;
  var delta = 1;
  var navbarHeight = $('[role="navigation"]').outerHeight();

  $(window).scroll(function(event) {
    didScroll = true;
  });

  setInterval(function() {
    if (didScroll) {
      hasScrolled();
      didScroll = false;
    }
  }, 250);

  function hasScrolled() {
    var st = $(this).scrollTop();

    if (Math.abs(lastScrollTop - st) <= delta)
      return;

    if (st > lastScrollTop && st > navbarHeight) {
      // Scroll Down
      $('[role="navigation"]').addClass('navbar-scroll-down');
    } else {
      // Scroll Up
      if (st + $(window).height() < $(document).height()) {
        $('[role="navigation"]').removeClass('navbar-scroll-down');
      }
    }

    lastScrollTop = st;
  }
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Analytics@Sauder</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="contribute.html">Contribute</a>
</li>
<li>
  <a href="https://blogs.ubc.ca/businessanalytics">Blog</a>
</li>
<li>
  <a href="projects.html">Projects</a>
</li>
<li>
  <a href="resource.html">Resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Web Scraping</h1>

</div>


<p>In this project, we would review the web data extraction and see an example of its application on a weather website. Scraping of websites is a very useful activity especially to achieve recruiting or marketing tasks. All of the code can be found in the MBAN GitHub repository, feel free to download it and modify for your use case.</p>
<p><a href="https://pims.syzygy.ca/jupyter/user/qingkangcao/git-pull?repo=https%3A%2F%2Fgithub.com%2FMaster-of-Business-Analytics%2FProject_09_Web_Scraping&urlpath=tree%2FProject_09_Web_Scraping%2F" target="_blank" class="button">Launch Syzygy</a></p>
<div id="what-is-web-scraping" class="section level2">
<h2>What is Web Scraping?</h2>
<p>Web Scraping is a technique used to extract data from websites. A prerequisite to web scraping is knowing a little bit about HTML code to know where the data to be captured is located in the HTML code. If you have ever copy and pasted information from a website, you have performed the same function as any web scraper, only on a smaller, manual scale.</p>
<p>One way to scrape data is through Direct HTTP Requests. Websites are just a rendering of the HTML and CSS code that the web server returns as a result of a GET request of your browser. As a result, a simple script can send automatically HTTP requests and parse the answer, scraping the content. The python-requests package is used to make this request and enable data scraping.</p>
<p>Sometimes websites load the content asynchronously. This means that the information to be scraped may not be contained in the first HTTP response, but are loaded only as a consequence of a page scrolling or after the click of a button. To overcome this barrier a Web Browser Driver, Selenium Web Driver, is used. The Web Browser drivers let you run a real web browser enabling your Python script to emulate user behavior on the page.</p>
<p>Web scraping is a complicated process because all web pages do not follow the same format. Therefore, the code used to scrape data from a particular website can not be reapplied to another website. Therefore the python code has to customize the web-site’s HTML structure. However, websites can not be scraped multiple times as this can overload the server hosting the website, especially smaller websites.</p>
</div>
<div id="basic-project" class="section level2">
<h2>Basic project</h2>
<p>In this project, we will scrap a seven-day weather forecast for Houston from a static weather forecast website.</p>
<p>First of all, load the required packages. The requests package is used to make a request to the website and enable us to download web pages that are loaded into the python environment</p>
<pre class="python"><code>import requests
from bs4 import BeautifulSoup
import pandas as pd</code></pre>
<p><b> Request URL</b></p>
<pre class="python"><code>#link of website to be scraped
url = &quot;https://forecast.weather.gov/MapClick.php?lat=29.685271900000032&amp;lon=-95.43426899999997#.XvL4ti-z1ZJ&quot;

page = requests.get(url)
soup = BeautifulSoup(page.content, &#39;html.parser&#39;)</code></pre>
<p>The BeautifulSoup constructor parses raw HTML strings and produces an object that mirrors the HTML document’s structure. This makes web scraping very easy as you are able to find all the HTML tags. The output is the source code of the website.</p>
<p>For example, the code below extracts all the a tag in the web page. The a tag defines a hyperlink, which is used to link from one page to another.</p>
<pre class="python"><code>#To find all the links in the web page (a-tags in the output)
print(soup.find_all(&#39;a&#39;)[0])

</code></pre>
<pre><code>&lt;a class=&quot;pull-left&quot; href=&quot;http://www.noaa.gov&quot; id=&quot;header-noaa&quot;&gt;&lt;img alt=&quot;National Oceanic and Atmospheric Administration&quot; src=&quot;/css/images/header_noaa.png&quot;/&gt;&lt;/a&gt;
</code></pre>
<p>To identify the section that hosts tag the information that is needed, the source code of the web page can be checked by using the browser developer tools. The diagram below shows the web page and its corresponding source code. This is useful when identifying the tag id containing the information to be scraped from the web page.</p>
<p><img src="images/p09_01.png" /></p>
<p>The developer source code shows that the tag id is seven-day-forecast-container.</p>
<pre class="python"><code>#component of the html code contacting weather information
week = soup.find(id=&#39;seven-day-forecast-body&#39;)
</code></pre>
<p>This shows every information contained in that tag id. To access all the items in this object week (weekdays), the information in the class tag “tombstone-container” is captured.</p>
<pre class="python"><code>#Extracting information for the week
items = week.find_all(class_= &quot;tombstone-container&quot;)
#extracting the first item in the items list - day 1 
day1=items[0] 
day1</code></pre>
<pre><code>&lt;div class=&quot;tombstone-container&quot;&gt;
&lt;p class=&quot;period-name&quot;&gt;Overnight&lt;br/&gt;&lt;br/&gt;&lt;/p&gt;
&lt;p&gt;&lt;img alt=&quot;Overnight: A 30 percent chance of showers and thunderstorms.  Mostly cloudy, with a low around 78. Calm wind becoming east around 5 mph. &quot; class=&quot;forecast-icon&quot; src=&quot;newimages/medium/nscttsra30.png&quot; title=&quot;Overnight: A 30 percent chance of showers and thunderstorms.  Mostly cloudy, with a low around 78. Calm wind becoming east around 5 mph. &quot;/&gt;&lt;/p&gt;&lt;p class=&quot;short-desc&quot;&gt;Chance&lt;br/&gt;T-storms&lt;/p&gt;&lt;p class=&quot;temp temp-low&quot;&gt;Low: 78 °F&lt;/p&gt;&lt;/div&gt;</code></pre>
<p>Each item contains all coding and image relating to one day. The information in each item in the item list is broken into columns: Day, weather description, and temperature. A for-loop is used to extract all relevant weather information.</p>
<pre class="python"><code># extracting day from first item in list &#39;items&#39;
print(day1.find(class_= &quot;period-name&quot;).get_text())  #day</code></pre>
<pre><code>NOW until7:00am Wed</code></pre>
<pre class="python"><code>print(day1.find(class_= &quot;short-desc&quot;).get_text()) #weather</code></pre>
<pre><code>Flash Flood Watch</code></pre>
<pre class="python"><code>items[1].find(class_= &quot;temp&quot;).get_text()</code></pre>
<pre><code>&#39;Low: 75 °F&#39;</code></pre>
<p>A for-loop is used to loop through the items list to get the column information for each day.</p>
<pre class="python"><code># For-loop to days for the week

period_name=[]
for day in items:
    name=day.find(class_= &quot;period-name&quot;).get_text()
    period_name.append(name)
period_name #period</code></pre>
<pre><code>[&#39;NOW until7:00am Wed&#39;,
 &#39;Overnight&#39;,
 &#39;Wednesday&#39;,
 &#39;WednesdayNight&#39;,
 &#39;Thursday&#39;,
 &#39;ThursdayNight&#39;,
 &#39;Friday&#39;,
 &#39;FridayNight&#39;,
 &#39;Saturday&#39;]</code></pre>
<pre class="python"><code># For-loop to extract weather description for each day
short_description = []
for day in items:
    name=day.find(class_= &quot;short-desc&quot;).get_text()
    short_description.append(name)
short_description #period</code></pre>
<pre><code>[&#39;Flash Flood Watch&#39;,
 &#39;Heavy Rain&#39;,
 &#39;Heavy Rain&#39;,
 &#39;T-storms thenChanceT-storms&#39;,
 &#39;T-stormsLikely&#39;,
 &#39;T-stormsLikely thenChanceT-storms&#39;,
 &#39;ChanceT-storms&#39;,
 &#39;ChanceT-storms&#39;,
 &#39;ChanceT-storms&#39;]</code></pre>
<pre class="python"><code># For-loop to extract temperature for each day
temperature = []
for day in items:
    try:
        name=day.find(class_= &quot;temp&quot;).get_text()
    except:
        name = &quot;NA&quot;
    temperature.append(name)
temperature</code></pre>
<pre><code>[&#39;NA&#39;,
 &#39;Low: 75 °F&#39;,
 &#39;High: 86 °F&#39;,
 &#39;Low: 76 °F&#39;,
 &#39;High: 91 °F&#39;,
 &#39;Low: 78 °F&#39;,
 &#39;High: 90 °F&#39;,
 &#39;Low: 78 °F&#39;,
 &#39;High: 92 °F&#39;]</code></pre>
<p>The panda package is used to merge all output lists into a table.</p>
<pre class="python"><code>#combine lists into data table
weather_table = pd.DataFrame({&#39;Period&#39;:period_name,
                             &#39;Short description&#39;:short_description,
                             &#39;Temperature&#39;:temperature})

weather_table</code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
Period
</th>
<th>
Short description
</th>
<th>
Temperature
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
NOW until7:00am Wed
</td>
<td>
Flash Flood Watch
</td>
<td>
NA
</td>
</tr>
<tr>
<th>
1
</th>
<td>
Overnight
</td>
<td>
Heavy Rain
</td>
<td>
Low: 75 °F
</td>
</tr>
<tr>
<th>
2
</th>
<td>
Wednesday
</td>
<td>
Heavy Rain
</td>
<td>
High: 86 °F
</td>
</tr>
<tr>
<th>
3
</th>
<td>
WednesdayNight
</td>
<td>
T-storms thenChanceT-storms
</td>
<td>
Low: 76 °F
</td>
</tr>
<tr>
<th>
4
</th>
<td>
Thursday
</td>
<td>
T-stormsLikely
</td>
<td>
High: 91 °F
</td>
</tr>
<tr>
<th>
5
</th>
<td>
ThursdayNight
</td>
<td>
T-stormsLikely thenChanceT-storms
</td>
<td>
Low: 78 °F
</td>
</tr>
<tr>
<th>
6
</th>
<td>
Friday
</td>
<td>
ChanceT-storms
</td>
<td>
High: 90 °F
</td>
</tr>
<tr>
<th>
7
</th>
<td>
FridayNight
</td>
<td>
ChanceT-storms
</td>
<td>
Low: 78 °F
</td>
</tr>
<tr>
<th>
8
</th>
<td>
Saturday
</td>
<td>
ChanceT-storms
</td>
<td>
High: 92 °F
</td>
</tr>
</tbody>
</table>
</div>
<p>This Table can be converted to a CSV file and used for data manipulation and analysis. This web scraping code can be used for different locations on the same website. Web scraping is an essential tool that almost every data analyst needs.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>The incredible amount of data on the Internet is a rich resource for any field of research or personal interest. To effectively harvest that data, web scraping is a necessary skill. The Python library’s requests and Beautiful Soup are powerful tools for the job. However, there are some challenges in web Scraping. Each website is unique and will need a customized treatment to extract the relevant information.Additionally, websites constantly change therefore once the site’s structure has changed, the scraper might not be able to find the relevant information.</p>
<p>Web scraping can be used for social media analysis, product analysis, or financial analysis. An alternative way of accessing web data is requesting access through an API. An API (Application Programming Interface) is a set of procedures and communication protocols that provide access to the data of an application, operating system, or other services. <a href="https://opensource.com/article/20/5/web-scraping-python">OpenSource</a> provides a valuable learning resource regarding web scraping using Python.</p>
</div>

<div class="footer">
  <p style="text-align: center;">
    <!-- Add icon library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <a href="https://github.com/Master-of-Business-Analytics" class="fa fa-github fa-2x"></a>
    <br/>
    Created and maintained by the
    <br/>
    <a href="https://www.sauder.ubc.ca/programs/masters-degrees/mban">Master of Business Analytics</a> Community
    <br/>
    Licensed under a
    <br/>
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.
    <br/>
    <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a>
  </p>
</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
